name: Playwright SOX Tests
on:
 pull_request:
   branches: [main]
 push:
   branches: [main]
 workflow_dispatch:

permissions:
     contents: read
     pull-requests: read
     actions: write
    
jobs:
 test:
   timeout-minutes: 30
   runs-on: [ubuntu-latest]
   steps:
   - uses: actions/checkout@v3
   - uses: actions/setup-node@v3
     with:
       node-version: 20.x
       check-latest: false

   - name: Install dependencies
     run: yarn install --frozen-lockfile

   - name: Install Playwright Browsers
     run: yarn pw:install-browsers:ci

   - name: Run Playwright tests
     run: yarn pw:test:ci:github
   - uses: actions/upload-artifact@v3
     if: always()
     with:
         name: test-results
         path: test-results
         if-no-files-found: error
         retention-days: 15
      - name: Setup Pages
        uses: actions/configure-pages@v2
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1
        with:
          # Upload entire repository
          path: test-merge-report-demo/
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1

